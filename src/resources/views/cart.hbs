<!-- Bọc cả phần cart và thanh toán trong div này -->

<form action="/cart/thanhtoan" method="post" id="cartForm">
  <div class="max-w-6xl mx-auto mt-10 flex gap-6">

    <!-- Phần thanh toán -->
    <div class="w-full max-w-sm bg-white p-6 rounded-2xl shadow-xl">
      <div class="flex justify-between text-gray-700 mb-2">
        <span>Thành tiền</span>
        <span class="total-amount">0 đ</span>
      </div>
      <hr class="my-2">
      <div class="flex justify-between font-bold text-lg text-gray-900 mb-4">
        <span>Tổng Số Tiền (gồm VAT)</span>
        <input type="hidden" name="tongTien" id="tongTienInput" value="0">
        <span class="total-amount text-red-600">0 đ</span>
      </div>

      <button type="submit"
        class="w-full bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-600">
        THANH TOÁN
      </button>
    </div>

    <!-- Phần giỏ hàng -->
    <div class="max-w-4xl mx-auto mt-10 bg-white p-6 rounded-2xl shadow-xl">
      <h1 class="text-2xl font-bold mb-6 text-gray-800">Giỏ Sách Của Bạn</h1>

      {{#each cart}}
      <div class="flex items-start space-x-4 border-b pb-6 mb-6">
        <img src="{{this.Anh}}" class="w-20 h-28 object-cover rounded" alt="">
        <div class="flex-1">
          <h2 class="text-lg font-semibold text-gray-900">{{this.TenSanPham}}</h2>
          <p class="text-red-600 font-semibold mt-2 item-price" data-price="{{this.Gia}}">
            {{this.Gia}} đ
            <span class="line-through text-gray-400 ml-2">90.000 đ</span>
          </p>
        </div>

        <div class="flex items-center space-x-2">
          <button type="button" class="px-2 py-1 text-lg font-bold border rounded decrease">−</button>
          <span class="quantity">1</span>
          <input type="hidden" name="soluong[]" class="quantity-input" value="1">
          <input type="hidden" name="idSanPham[]" value="{{this.SanPhamID}}">
          <button type="button" class="px-2 py-1 text-lg font-bold border rounded increase">+</button>
        </div>

        <div class="text-red-600 font-semibold ml-6 item-total" data-price="{{this.Gia}}">
          {{this.Gia}} đ
        </div>
      </div>
      {{/each}}
    </div>
  </div>
</form>


<script>
function formatCurrency(value) {
  return new Intl.NumberFormat('vi-VN').format(value) + ' đ';
}

function updateTotal() {
  const prices = document.querySelectorAll('.item-price');
  const quantities = document.querySelectorAll('.quantity');
  const quantityInputs = document.querySelectorAll('.quantity-input');
  const itemTotals = document.querySelectorAll('.item-total');
  let total = 0;

  prices.forEach((priceEl, index) => {
    const price = parseFloat(priceEl.getAttribute('data-price'));
    const qty = parseInt(quantities[index].textContent);
    quantityInputs[index].value = qty; // cập nhật input ẩn

    const itemTotal = price * qty;
    itemTotals[index].textContent = formatCurrency(itemTotal);
    total += itemTotal;
  });

  // Cập nhật tổng tiền cho input ẩn
  document.getElementById('tongTienInput').value = total;

  document.querySelectorAll('.total-amount').forEach(el => {
    el.textContent = formatCurrency(total);
  });
}

document.querySelectorAll('.increase').forEach((btn, index) => {
  btn.addEventListener('click', () => {
    const qtyEl = document.querySelectorAll('.quantity')[index];
    qtyEl.textContent = parseInt(qtyEl.textContent) + 1;
    updateTotal();
  });
});

document.querySelectorAll('.decrease').forEach((btn, index) => {
  btn.addEventListener('click', () => {
    const qtyEl = document.querySelectorAll('.quantity')[index];
    let qty = parseInt(qtyEl.textContent);
    if (qty > 1) {
      qtyEl.textContent = qty - 1;
      updateTotal();
    }
  });
});

updateTotal(); // khởi tạo ban đầu
</script>

