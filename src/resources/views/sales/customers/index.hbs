{{#block "css"}}
  <link rel="stylesheet" href="/css/sales/style.css" />
  <link rel="stylesheet" href="/css/sales/customers.css" />
{{/block}}

{{#block "js"}}
  <script src="/js/sales/index.js"></script>
{{/block}}

<div class="main-content">
  <!-- nav bar -->
  <div class="navbar">
    <div class="navbar-toggle">
      {{! <i class="fas fa-bars"></i> }}
    </div>
    <div class="search-box">
      <label>
        <input type="text" placeholder="Tìm Kiếm" />
        <i class="fas fa-search"></i>
      </label>
    </div>
    <div class="user-profile">
      <a href="#"><img src="/user.jpg" /></a>
    </div>
  </div>

  <!-- Nội dung quản lý khách hàng -->
  <div class="customers-container">
    <div class="customer-header">
      <h2 class="customer-title">Quản lý khách hàng</h2>
      {{#if (or (includes permissions "qlkhachhang") (includes permissions "qlbanhang"))}}
        <a href="/admin/sales/khachhang/create" class="add-button">
          <i class="fas fa-plus"></i> Thêm khách hàng
        </a>
      {{/if}}
    </div>

    {{#if success}}
      <div class="alert alert-success">{{success}}</div>
    {{/if}}

    {{#if error}}
      <div class="alert alert-danger">{{error}}</div>
    {{/if}}

    <!-- Bộ lọc khách hàng -->
    <div class="customer-filters">
      <form class="filter-form" action="/admin/sales/khachhang" method="GET">
        <div class="filter-group">
          <input type="text" name="keyword" placeholder="Tên hoặc SĐT khách hàng" value="{{query.keyword}}" />
        </div>
        <div class="form-buttons-container">
          <button class="filter-button" type="submit">
            <i class="fas fa-filter"></i> Lọc
          </button>
          <a href="/admin/sales/khachhang" class="reset-button">
            <i class="fas fa-sync-alt"></i> Làm mới
          </a>
          <button type="button" class="export-button">
            <i class="fas fa-file-export"></i> Xuất Excel
          </button>
        </div>
      </form>
    </div>

    <!-- Bảng danh sách khách hàng -->
    <div class="customer-table-container">
      <table class="customers-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tên tài khoản</th>
            <th>Tên khách hàng</th>
            <th>Số điện thoại</th>
            <th>Ngày sinh</th>
            <th class="text-center" style="width: 120px;">Thao tác</th>
          </tr>
        </thead>
        <tbody>
          {{#each customers}}
            <tr>
              <td>{{this.ID_KH}}</td>
              <td>{{this.TenTK}}</td>
              <td>{{this.TenKH}}</td>
              <td>{{this.SDT}}</td>
              <td>{{formatDate this.NgaySinh}}</td>
              <td class="action-buttons">
                <a href="/admin/sales/khachhang/details/{{this.ID_KH}}" class="action-button view-button" title="Xem chi tiết">
                  <i class="fas fa-eye"></i>
                </a>
                {{#if ../permissions}}
                  {{#if (or (includes ../permissions "qlkhachhang") (includes ../permissions "qlbanhang"))}}
                    <a href="/admin/sales/khachhang/edit/{{this.ID_KH}}" class="action-button edit-button" title="Chỉnh sửa">
                      <i class="fas fa-edit"></i>
                    </a>
                    <form action="/admin/sales/khachhang/delete/{{this.ID_KH}}" method="POST" style="display:inline;">
                      <button type="submit" class="action-button delete-button" onclick="return confirm('Bạn có chắc muốn xóa khách hàng này?');" title="Xóa">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  {{/if}}
                {{/if}}
              </td>
            </tr>
          {{else}}
            <tr>
              <td colspan="6">
                <div class="no-results-message">
                  <i class="fas fa-search"></i>
                  <p>Không tìm thấy khách hàng nào.</p>
                </div>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Highlight current menu item
    const currentPath = window.location.pathname;
    const menuItems = document.querySelectorAll('.sidebar li a');
    
    menuItems.forEach(item => {
      if (item.getAttribute('href') === currentPath || 
          (currentPath.includes('/admin/sales/khachhang') && item.getAttribute('href') === '/admin/sales/khachhang')) {
        item.parentElement.classList.add('active');
      }
    });
  });
</script>